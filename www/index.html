<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
    <title>پارسه</title>
    <link rel="stylesheet" href="css/themes/default/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="css/yekan.css">
    <link rel="stylesheet" href="css/custom.css">
    
	<script src="js/jquery.min.js"></script>
    <script src="phonegap.js"></script>
    <script src="js/fastclick.js"></script>
    <script src="js/index.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/jquery.md5.js"></script>
    <script src="js/jquery.blockUI.js"></script>
    <script src="js/menu.js"></script>
    <script src="js/page_content.js"></script>
	<script src="PushNotification.js" type="text/javascript" ></script>

	<script>
		function init() {			
			console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    start init()');
			document.addEventListener("deviceready", onDeviceReady, false);
			//onDeviceReady();
		}
		

////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// START push Notification :////////////////////////////////////////////////////////////////
	 var register_for_notifs;// = window.localStorage.getItem('register_for_notifs');
	 function onNotificationGCM(e) {
		//alert("uuuuuu");
		//$("#app-status-ul").append('<li>EVENT -> RECEIVED:' + e.event + '</li>');

		switch( e.event )
		{
		case 'registered':
			if ( e.regid.length > 0 )
			{
				//$("#app-status-ul").append('<li>REGISTERED -> REGID:' + e.regid + "</li>");
				// Your GCM push server needs to know the regID before it can push to this device
				// here is where you might want to send it the regID for later use.
				//console.log("regID = " + e.regid);
				//alert("regID = " + e.regid);
				//if(register_for_notifs){
					$.ajax({ type: "POST",
							url: "http://parseh.smcms.ir/SMCMS_notification/RegisterDeviceIDtoDB.php", 
							data: {regID : e.regid,user:device.uuid,OS:device.platform},
							async: false,
							success : function(text)
							{
								//last_articles_version = text;
								console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    Notification registration text : ' + text);
								window.localStorage.setItem('register_for_notifs','yes');
							}
					});
				//}
			}
		break;

		case 'message':
			// if this flag is set, this notification happened while we were in the foreground.
			// you might want to play a sound to get the user's attention, throw up a dialog, etc.
			if ( e.foreground )
			{
				//$("#app-status-ul").append('<li>--INLINE NOTIFICATION--' + '</li>');

				// if the notification contains a soundname, play it.
				//var my_media = new Media("/android_asset/www/"+e.soundname);
				//my_media.play();
			}
			else
			{  // otherwise we were launched because the user touched a notification in the notification tray.
				/*
				if ( e.coldstart )
				{
					$("#app-status-ul").append('<li>--COLDSTART NOTIFICATION--' + '</li>');
				}
				else
				{
					$("#app-status-ul").append('<li>--BACKGROUND NOTIFICATION--' + '</li>');
				}
				*/
			}
			
			alert(e.payload.message);
			//alert(e.payload.msgcnt);
			/*
			$("#app-status-ul").append('<li>MESSAGE -> MSG: ' + e.payload.message + '</li>');
			$("#app-status-ul").append('<li>MESSAGE -> MSGCNT: ' + e.payload.msgcnt + '</li>');
			*/
		break;

		case 'error':
			//$("#app-status-ul").append('<li>ERROR -> MSG:' + e.msg + '</li>');
		break;

		default:
			//$("#app-status-ul").append('<li>EVENT -> Unknown, an event was received and we do not know what it is</li>');
		break;
	  }
	}
	function successHandler (result) {
		//alert('result = ' + result);
	}
	// result contains any error description text returned from the plugin call
	function errorHandler (error) {
		//alert('error = ' + error);
	}
// END push Notification ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
		function onDeviceReady() {
			window.sessionStorage.setItem('we_are_in',"index");
			FastClick.attach(document.getElementById('container'));
			
			if ( device.platform == 'Android' ){//Android,iOS,win7=WinCE,win8=Win32NT
				document.addEventListener("backbutton", go_back, false);
			}
			if(window.sessionStorage.getItem('LOAD_URL') == null)
			{
				window.sessionStorage.setItem('LOAD_URL',JSON.stringify(["786","110"]));				
			}
			if(window.sessionStorage.getItem('registered') == null)
			{
				window.localStorage.setItem('registered',0);				
			}

			
			//getURL("http://parseh.smcms.ir?uuid=" + device.uuid + "&registered=" + window.localStorage.getItem('registered'),true,false);
			getURL_silent("http://parseh.smcms.ir?uuid=" + device.uuid + "&registered=" + window.localStorage.getItem('registered'),true,false);

			//getMENU();
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// START push Notification :////////////////////////////////////////////////////////////////
			pushNotification = window.plugins.pushNotification;
			//if(window.localStorage.getItem('register_for_notifs')=="yes"){
			//	console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    register_for_notifs : yes');
			//}
			//else
			//{
				console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    register_for_notifs : no // ' + device.platform);
				if ( device.platform == 'android' || device.platform == 'Android' || device.platform == "amazon-fireos" ){
					pushNotification.register(successHandler,errorHandler,{"senderID":"804625540618","ecb":"onNotificationGCM"});
				} else {
					pushNotification.register(tokenHandler,errorHandler,{"badge":"true","sound":"true","alert":"true","ecb":"onNotificationGCM"});//"onNotificationAPN"});
				}
			//}
			function tokenHandler(result) {
				console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    Notification Callback Success! Result (ios) = '+result);
				//if(register_for_notifs){
					$.ajax({ type: "POST",
							url: "http://parseh.smcms.ir/SMCMS_notification/RegisterDeviceIDtoDB.php", 
							data: {regID : result,user:device.uuid,OS:device.platform},
							async: false,
							success : function(text)
							{
								//last_articles_version = text;
								console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    Notification registration text : ' + text);
								window.localStorage.setItem('register_for_notifs','yes');
							}
					});
				//}
			}
// END push Notification ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
		}
		function loadcompeleted() {
			$("#loading").html("");
		}
	</script>
	
	
	
<style>
*{text-rendering:auto !important;}


</style>
</head>
<body onload="init();">

<div data-role="page" class="jqm-demos ui-responsive-panel" id="panel-responsive-main" >

    <div data-role="header" data-position="fixed" data-fullscreen="false">
        <h1 style="font-weight: normal; text-shadow: 0px 0px 0px transparent;"><img src="images/news/header.png" class="header-image">دندانپزشکی پارسه</h1>
		<a href="#nav-panel" data-icon="bars" data-iconpos="notext"  class="ui-btn-right menu nofastclick">Menu</a>
    </div><!-- /header -->

    <div role="main" class="ui-content jqm-content jqm-fullwidth">
		<div class="container" id="container" >

			<table  class="mainmenu" dir="rtl" cellspacing="0" cellpadding="0" align="center" style='-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;' unselectable='on' onselectstart='return false;' >
				<tr>
					<td  onclick="openURL('http://parseh.smcms.ir/',true,false);"  ><img src="images/mainmenu/01.png" id="test" unselectable='on' onselectstart='return false;' /></a></td>
					<td  onclick="openURL('http://parseh.smcms.ir/آخرین-اخبار',true,false);" ><img src="images/mainmenu/02.png" unselectable='on' onselectstart='return false;' /></a></td>
					<td  onclick="openURL('http://parseh.smcms.ir/ثبت-نام-کلاس-های-رزیدنتی',true,false);" ><img src="images/mainmenu/03.png" unselectable='on' onselectstart='return false;' /></a></td>
				</tr>
				<tr>
					<td  onclick="openURL('http://parseh.smcms.ir/محتوای-دروس-رزیدنتی',true,false);" ><img src="images/mainmenu/04.png" unselectable='on' onselectstart='return false;' /></a></td>
					<td  onclick="openURL('http://parseh.smcms.ir/مشاوره-و-برنامه-ریزی',true,false);" ><img src="images/mainmenu/05.png" /></a></td>
					<td  onclick="openURL('http://parseh.smcms.ir/ثبت-نام-آزمون-ها',true,false);" ><img src="images/mainmenu/06.png" /></a></td>
				</tr>
				<tr>
					<td  onclick="openURL('http://parseh.smcms.ir/محتوای-سوالات-و-آزمون-ها',true,false);" ><img src="images/mainmenu/07.png" /></a></td>
					<td  onclick="openURL('http://parseh.smcms.ir/محتوای-دروس-مرور-سریع',true,false);" ><img src="images/mainmenu/08.png" /></a></td>
					<td  onclick="openURL('http://parseh.smcms.ir/دوره-ھای-آموزش-کوتاه-مدت',true,false);" ><img src="images/mainmenu/09.png" /></a></td>
				</tr>
				<tr>
					<td  onclick="openURL('http://parseh.smcms.ir/فيلم-ھای-آموزشی-رایگان',true,false);" ><img src="images/mainmenu/10.png" /></a></td>
					<td  onclick="openURL('http://parseh.smcms.ir/آرشيو-نشریات',true,false);" ><img src="images/mainmenu/11.png" /></a></td>
					<td  onclick="window.location.href = 'contact.html';" ><img src="images/mainmenu/12.png" /></a></td>
				</tr>
			</table>
			<br/><br/>
		
<script>

$('.mainmenu img').on('dragstart', function(event) { event.preventDefault();				});
/*
$('.mainmenu img').on('swipe', function(event) {
			event.preventDefault();
			if ( $.mobile.activePage.jqmData( "panel" ) !== "open" ) {
				if ( event.type === "swipeleft"  ) {
					//$( "#right-panel" ).panel( "open" );
					alert("1");
				} else if ( event.type === "swiperight" ) {
					$( "#nav-panel" ).panel( "close" );
					alert("2");
				}
			}
			if ( $.mobile.activePage.jqmData( "panel" ) !== "close" ) {
				if ( event.type === "swipeleft"  ) {
					$( "#nav-panel" ).panel( "open" );
					alert("3");
				} else if ( event.type === "swiperight" ) {
					$( "#nav-panel" ).panel( "close" );
					alert("4");
				}
			}
		}
);
*/
//$('.mainmenu img').on('dragend', function(event) { event.preventDefault();		alert();		});
//$('.mainmenu img').on('dragstop', function(event) { event.preventDefault();		alert();		});
//document.getElementById('test').ondragstart = function() { alert();return false; };
</script>
		
		</div>

	</div><!-- /content -->

    <div id="footer"></div><!-- /footer -->
</div><!-- /page -->
</body>
</html>
